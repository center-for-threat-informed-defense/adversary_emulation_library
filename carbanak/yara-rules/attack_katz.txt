rule password_strings
{
	meta:
		author = "MITRE Engenuity"
		date = "2/16/2021"
		description = "Used to detect strings associated with passwords"
	
    strings:
        $password_strings1 = "NTPASSWORDHISTORY"
		$password_strings2 = "LMPASSWORDHISTORY"
		$password_strings3 = "NTPASSWORD"
		$password_strings4 = "LMPASSWORD"
		$password_strings5 = "mimikatz" nocase

    condition:
        all of them
}

rule rpc_functions
{
	meta:
		author = "MITRE Engenuity"
		date = "2/16/2021"
		description = "Used to detect functions associated with rpc"
	
    strings:
        $rpc_functions1 = "RpcBindingFree"
		$rpc_functions2 = "RpcBindingFromStringBindingW"
		$rpc_functions3 = "RpcBindingInqAuthClientW"
		$rpc_functions4 = "RpcBindingSetAuthInfoExW"
		$rpc_functions5 = "RpcBindingSetOption"
		$rpc_functions6 = "RpcBindingToStringBindingW"
		$rpc_functions7 = "RpcBindingVectorFree"
		$rpc_functions8 = "RpcEpRegisterW"
		$rpc_functions9 = "RpcEpResolveBinding"
		$rpc_functions10 = "RpcEpUnregister"
		$rpc_functions11 = "RpcImpersonateClient"
		$rpc_functions12 = "RpcMgmtEpEltInqBegin"
		$rpc_functions13 = "RpcMgmtEpEltInqDone"
		$rpc_functions14 = "RpcMgmtEpEltInqNextW"
		$rpc_functions15 = "RpcMgmtStopServerListening"
		$rpc_functions16 = "RpcMgmtWaitServerListen"
		$rpc_functions17 = "RpcRevertToSelf"
		$rpc_functions18 = "RpcServerInqBindings"
		$rpc_functions19 = "RpcServerListen"
		$rpc_functions20 = "RpcServerRegisterAuthInfoW"
		$rpc_functions21 = "RpcServerRegisterIf2"
		$rpc_functions22 = "RpcServerUnregisterIfEx"
		$rpc_functions23 = "RpcServerUseProtseqEpW"
		$rpc_functions24 = "RpcStringBindingComposeW"
		$rpc_functions25 = "RpcStringFreeW"
		
    condition:
        all of them
}

rule functions
{
	meta:
		author = "MITRE Engenuity"
		date = "7/17/2020"
		description = "Used to detect functions associated with attackkatz.exe"
	
    strings:
		$functions1 = "AcquireCredentialsHandleW"
		$functions2 = "ASN1_"
		$functions3 = "CDLocateCheckSum"
		$functions4 = "CDLocateCSystem"
		$functions5 = "CertAddCertificateContextToStore"
		$functions6 = "CertAddEncodedCertificateToStore"
		$functions7 = "CertCloseStore"
		$functions8 = "CertEnumCertificatesInStore"
		$functions9 = "CertEnumSystemStore"
		$functions10 = "CertFindCertificateInStore"
		$functions11 = "CertFreeCertificateContext"
		$functions12 = "CertGetCertificateContextProperty"
		$functions13 = "CheckTokenMembership"
		$functions14 = "CloseClipboard"
		$functions15 = "CloseHandle"
		$functions16 = "CloseServiceHandle"
		$functions17 = "CoCreateInstance"
		$functions18 = "CPDecrypt"
		$functions19 = "CPDeriveKey"
		$functions20 = "CPDestroyKey"
		$functions21 = "CPDuplicateKey"
		$functions22 = "CPEncrypt"
		$functions23 = "CPExportKey"
		$functions24 = "CPGenKey"
		$functions25 = "CPGetKeyParam"
		$functions26 = "CPImportKey"
		$functions27 = "CPSetKeyParam"
		$functions28 = "CreateProcess"
		$functions29 = "CreateRemoteThread"
		$functions30 = "CreateServiceW"
		$functions31 = "CredentialKeys"
		$functions32 = "CredEnumerateW"
		$functions33 = "CredFree"
		$functions34 = "CredIsMarshaledCredentialW"
		$functions35 = "CredUnmarshalCredentialW"
		$functions36 = "CryptAcquireCertificatePrivateKey"
		$functions37 = "CryptAcquireContext"
		$functions38 = "CryptEnumProviders"
		$functions39 = "CryptGetHashParam"
		$functions40 = "CryptGetKeyParam"
		$functions41 = "CryptHashData"
		$functions42 = "CryptImportKey"
		$functions43 = "CryptSetHashParam"
		$functions44 = "DeleteProcThreadAttributeList"
		$functions45 = "DeleteSecurityContext"
		$functions46 = "DsEnumerateDomainTrustsW"
		$functions47 = "DuplicateHandle"
		$functions48 = "DuplicateTokenEx"
		$functions49 = "EnterCriticalSection"
		$functions50 = "EnumClipboardFormats"
		$functions51 = "EnumerateSecurityPackagesW"
		$functions52 = "FreeCredentialsHandle"
		$functions53 = "FreeEnvironmentStringsW"
		$functions54 = "GetClipboard"
		$functions55 = "GetCommandLine"
		$functions56 = "GetComputerName"
		$functions57 = "GetConsoleScreenBufferInfo"
		$functions58 = "GetCurrentDirectory"
		$functions59 = "GetCurrentProcess"
		$functions60 = "GetCurrentThread"
		$functions61 = "GetEnvironmentStrings"
		$functions62 = "GetFile"
		$functions63 = "GetModule"
		$functions64 = "GetProcAddress"
		$functions65 = "GetSystem"
		$functions66 = "GetTemp"
		$functions67 = "GetTickCount"
		$functions68 = "GetTokenInformation"
		$functions69 = "HeapAlloc"
		$functions70 = "HeapCompact"
		$functions71 = "HeapCreate"
		$functions72 = "HidD_"
		$functions73 = "I_Net"
		$functions74 = "I_Rpc"
		$functions75 = "IsDebuggerPresent"
		$functions76 = "LeaveCriticalSection"
		$functions77 = "LocalAlloc"
		$functions78 = "LockFile"
		$functions79 = "LockWorkStation"
		$functions80 = "LookupAccountSidW"
		$functions81 = "LookupPrivilegeValueW"
		$functions82 = "LsaCallAuthenticationPackage"
		$functions83 = "LsaClose"
		$functions84 = "LsaEnumerateTrustedDomainsEx"
		$functions85 = "LsaFreeMemory"
		$functions86 = "LsaFreeReturnBuffer"
		$functions87 = "LsaOpen"
		$functions88 = "LsaQuery"
		$functions89 = "LsaRetrievePrivateData"
		$functions90 = "lstrlen"
		$functions91 = "MapViewOfFile"
		$functions92 = "MD5Update"
		$functions93 = "memcpy"
		$functions94 = "MemMax"
		$functions95 = "MesDecodeIncrementalHandleCreate"
		$functions96 = "Ncrypt"
		$functions97 = "NdrClientCall2"
		$functions98 = "NdrMesType"
		$functions99 = "NdrServerCall2"
		$functions100 = "NetShareEnum"
		$functions101 = "NetStatisticsGet"
		$functions102 = "NetWkstaUserEnum"
		$functions103 = "Noop"
		$functions104 = "NtCompareTokens"
		$functions105 = "NtEnumerateSystemEnvironmentValuesEx"
		$functions106 = "NtQuery"
		$functions107 = "NtResumeProcess"
		$functions108 = "NtSuspendProcess"
		$functions109 = "NtTerminateProcess"
		$functions110 = "OpenClipboard"
		$functions111 = "OpenThreadToken"
		$functions112 = "OpenWrite"
		$functions113 = "OutputDebugString"
		$functions114 = "PathCanonicalizeW"
		$functions115 = "PFXExportCertStoreEx"
		$functions116 = "ProcessIdToSessionId"
		$functions117 = "QueryContextAttributesW"
		$functions118 = "QueryPerformanceCounter"
		$functions119 = "QueryService"
		$functions120 = "ReadCookie"
		$functions121 = "ReadFile"
		$functions122 = "ReadProcessMemory"
		$functions123 = "RegEnum"
		$functions124 = "RegisterServiceCtrlHandlerW"
		$functions125 = "RegOpenKeyExW"
		$functions126 = "RegQuery"
		$functions127 = "RegSetValueExW"
		$functions128 = "RtlAdjustPrivilege"
		$functions129 = "RtlLookupFunctionEntry"
		$functions130 = "RtlStringFromGUID"
		$functions131 = "RtlUnicodeStringToAnsiString"
		$functions132 = "RtlUnwind"
		$functions133 = "RtlUnwindEx"
		$functions134 = "RtlUpcaseUnicodeString"
		$functions135 = "RtlUpcaseUnicodeStringToOemString"
		$functions136 = "RtlVirtualUnwind"
		$functions137 = "SamCloseHandle"
		$functions138 = "SamConnect"
		$functions139 = "SamEnumerate"
		$functions140 = "SamFreeMemory"
		$functions141 = "SamGetAliasMembership"
		$functions142 = "SamGetGroupsForUser"
		$functions143 = "SamGetMembers"
		$functions144 = "SamiChangePasswordUser"
		$functions145 = "SamLookup"
		$functions146 = "SamOpen"
		$functions147 = "SamQueryInformationUser"
		$functions148 = "SamrCloseHandle"
		$functions149 = "SamRidToSid"
		$functions150 = "SamrOpen"
		$functions151 = "Scard"
		$functions152 = "SetClipboardViewer"
		$functions153 = "SetConsole"
		$functions154 = "SetCookie"
		$functions155 = "SetCurrentDirectoryW"
		$functions156 = "SetEndOfFile"
		$functions157 = "SetEnvironmentVariableW"
		$functions158 = "SetEvent"
		$functions159 = "SetFile"
		$functions160 = "SetServiceObjectSecurity"
		$functions161 = "SetServiceStatus"
		$functions162 = "SetStdHandle"
		$functions163 = "SetThreadToken"
		$functions164 = "SetUnhandledExceptionFilter"
		$functions165 = "SetupDi"
		$functions166 = "Sleep"
		$functions167 = "SorterCompare"
		$functions168 = "SorterData"
		$functions169 = "SorterInsert"
		$functions170 = "SorterOpen"
		$functions171 = "SqlExec"
		$functions172 = "StartServiceCtrlDispatcherW"
		$functions173 = "StartServiceW"
		$functions174 = "SystemFunction"
		$functions175 = "SystemParametersInfoW"
		$functions176 = "SystemTimeToFileTime"
		$functions177 = "TerminateProcess"
		$functions178 = "TerminateThread"
		$functions179 = "TlsAlloc"
		$functions180 = "Trace"
		$functions181 = "TranslateMessage"
		$functions182 = "UnhandledExceptionFilter"
		$functions183 = "UnlockFile"
		$functions184 = "UnmapViewOfFile"
		$functions185 = "UnregisterClassW"
		$functions186 = "UpdateProcThreadAttribute"
		$functions187 = "UuidCreate"
		$functions188 = "UuidToStringW"
		$functions189 = "VBegin"
		$functions190 = "VColumn"
		$functions191 = "VCreate"
		$functions192 = "VDestroy"
		$functions193 = "VerQueryValueW"
		$functions194 = "VirtualAlloc"
		$functions195 = "VirtualFree"
		$functions196 = "VirtualProtect"

    condition:
        194 of them
}